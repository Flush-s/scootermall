{% load custom_filters %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ScooterMall - Магазин электросамокатов{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Лучшие электросамокаты от ведущих брендов. Быстрая доставка, гарантия, сервисное обслуживание.{% endblock %}">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        accent: {
                            500: '#f59e0b',
                            600: '#d97706',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'bounce-slow': 'bounce 2s infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* Custom focus styles */
        *:focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Product card hover */
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Glass effect */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="font-sans text-gray-800 bg-gray-50 min-h-screen flex flex-col">
    
    <!-- Header -->
    {% include 'includes/header.html' %}
    
    <!-- Messages -->
    {% if messages %}
    <div class="fixed top-20 right-4 z-50 space-y-2">
        {% for message in messages %}
        <div class="px-6 py-4 rounded-xl shadow-lg transform transition-all duration-300 animate-slide-up
            {% if message.tags == 'success' %}bg-green-500 text-white
            {% elif message.tags == 'error' %}bg-red-500 text-white
            {% elif message.tags == 'warning' %}bg-yellow-500 text-white
            {% else %}bg-blue-500 text-white{% endif %}">
            <div class="flex items-center gap-3">
                <i class="fas {% if message.tags == 'success' %}fa-check-circle
                    {% elif message.tags == 'error' %}fa-exclamation-circle
                    {% elif message.tags == 'warning' %}fa-exclamation-triangle
                    {% else %}fa-info-circle{% endif %}"></i>
                <span>{{ message }}</span>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-2 hover:opacity-75">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Main Content -->
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    {% include 'includes/footer.html' %}
    
    <!-- Mobile Bottom Navigation -->
    {% include 'includes/mobile_nav.html' %}
    
    <!-- JavaScript -->
    <script>
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // Search autocomplete
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            
            if (searchInput && searchResults) {
                let searchTimeout;
                
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    const query = this.value.trim();
                    
                    if (query.length < 2) {
                        searchResults.classList.add('hidden');
                        return;
                    }
                    
                    searchTimeout = setTimeout(() => {
                        fetch(`/search/ajax/?q=${encodeURIComponent(query)}`)
                            .then(response => response.text())
                            .then(html => {
                                searchResults.innerHTML = html;
                                searchResults.classList.remove('hidden');
                            });
                    }, 300);
                });
                
                // Hide search results on click outside
                document.addEventListener('click', function(e) {
                    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                        searchResults.classList.add('hidden');
                    }
                });
            }
            
            // Cart update functions
            window.updateCartItem = function(itemId, quantity) {
                const formData = new FormData();
                formData.append('quantity', quantity);
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                
                fetch(`/cart/update/${itemId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateCartDisplay(data);
                    }
                });
            };
            
            window.removeCartItem = function(itemId) {
                const formData = new FormData();
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
                
                fetch(`/cart/remove/${itemId}/`, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const item = document.getElementById(`cart-item-${itemId}`);
                        if (item) item.remove();
                        updateCartDisplay(data);
                    }
                });
            };
            
            function updateCartDisplay(data) {
                const cartCount = document.getElementById('cart-count');
                const cartTotal = document.getElementById('cart-total');
                
                if (cartCount) cartCount.textContent = data.cart_total;
                if (cartTotal) cartTotal.textContent = data.cart_price + ' ₽';
            }
        });
    </script>
    
    {% block extra_js %}{% endblock %}
    
    <!-- Chat Widget -->
    {% include 'includes/chat_widget.html' %}
</body>
</html>
