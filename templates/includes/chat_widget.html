<!-- Chat Widget -->
<div id="chat-widget" class="fixed bottom-20 right-4 z-50">
    <!-- Chat Button -->
    <button id="chat-toggle" class="w-14 h-14 bg-primary-600 hover:bg-primary-700 text-white rounded-full shadow-lg flex items-center justify-center transition-all hover:scale-110">
        <i class="fas fa-comments text-xl"></i>
    </button>
    
    <!-- Chat Window -->
    <div id="chat-window" class="hidden absolute bottom-16 right-0 w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden">
        <!-- Chat Header -->
        <div class="bg-primary-600 text-white p-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-headset"></i>
                </div>
                <div>
                    <p class="font-semibold">Поддержка</p>
                    <p class="text-xs text-primary-100">Обычно отвечаем за 5 мин</p>
                </div>
            </div>
            <button id="chat-close" class="w-8 h-8 hover:bg-white/20 rounded-lg flex items-center justify-center transition-colors">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Chat Messages -->
        <div id="chat-messages" class="h-80 overflow-y-auto p-4 space-y-4 bg-gray-50">
            <div class="flex gap-3">
                <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-robot text-primary-600 text-sm"></i>
                </div>
                <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm max-w-[80%]">
                    <p class="text-sm">Здравствуйте! Чем могу помочь?</p>
                    <p class="text-xs text-gray-400 mt-1">{{ now|date:"H:i" }}</p>
                </div>
            </div>
        </div>
        
        <!-- Chat Input -->
        <div class="p-4 bg-white border-t border-gray-100">
            <form id="chat-form" class="flex gap-2">
                <input type="text" id="chat-input" 
                    class="flex-1 px-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"
                    placeholder="Напишите сообщение...">
                <button type="submit" class="w-10 h-10 bg-primary-600 hover:bg-primary-700 text-white rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-paper-plane text-sm"></i>
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    // Chat toggle
    document.getElementById('chat-toggle').addEventListener('click', function() {
        const chatWindow = document.getElementById('chat-window');
        chatWindow.classList.toggle('hidden');
        if (!chatWindow.classList.contains('hidden')) {
            document.getElementById('chat-input').focus();
        }
    });
    
    // Chat close
    document.getElementById('chat-close').addEventListener('click', function() {
        document.getElementById('chat-window').classList.add('hidden');
    });
    
    // Chat form submit
    document.getElementById('chat-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = document.getElementById('chat-input');
        const message = input.value.trim();
        
        if (message) {
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Simulate bot response
            setTimeout(function() {
                const responses = [
                    'Спасибо за сообщение! Наш менеджер скоро ответит.',
                    'Понял вас! Передаю вопрос специалисту.',
                    'Интересный вопрос! Сейчас уточню информацию.',
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(randomResponse, 'bot');
            }, 1000);
        }
    });
    
    function addMessage(text, sender) {
        const messagesContainer = document.getElementById('chat-messages');
        const now = new Date();
        const time = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
        
        const messageHtml = sender === 'user' 
            ? `<div class="flex gap-3 justify-end">
                <div class="bg-primary-600 text-white p-3 rounded-2xl rounded-tr-none shadow-sm max-w-[80%]">
                    <p class="text-sm">${text}</p>
                    <p class="text-xs text-primary-100 mt-1">${time}</p>
                </div>
            </div>`
            : `<div class="flex gap-3">
                <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-robot text-primary-600 text-sm"></i>
                </div>
                <div class="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm max-w-[80%]">
                    <p class="text-sm">${text}</p>
                    <p class="text-xs text-gray-400 mt-1">${time}</p>
                </div>
            </div>`;
        
        messagesContainer.insertAdjacentHTML('beforeend', messageHtml);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
</script>
